<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Branch Service Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .test-container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px 10px 10px 0;
    }
    button:hover {
      background: #45a049;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-left: 4px solid #4CAF50;
      border-radius: 4px;
      white-space: pre-wrap;
      font-family: monospace;
      max-height: 400px;
      overflow-y: auto;
    }
    .error {
      border-left-color: #f44336;
      background: #ffebee;
    }
    .success {
      border-left-color: #4CAF50;
      background: #e8f5e9;
    }
    .info {
      border-left-color: #2196F3;
      background: #e3f2fd;
    }
    .loading {
      display: inline-block;
      margin-left: 10px;
      color: #666;
    }
    input {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
      width: 200px;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üè¢ Branch Service Test - Milestone 2</h1>
    <p>This page tests the branch service with hybrid storage (IndexedDB + Firebase)</p>
    
    <div style="margin: 20px 0;">
      <input type="text" id="branchName" placeholder="Branch Name" value="Downtown Branch">
      <button onclick="testCreateBranch()" id="createBtn">Create Branch</button>
      <button onclick="testGetAllBranches()" id="getAllBtn">Get All Branches</button>
      <button onclick="testClearBranches()" id="clearBtn">Clear Branches</button>
    </div>

    <div id="result" class="result info">
      Ready to test! Click "Create Branch" to start.
      <br><br>
      <strong>Test Steps:</strong>
      1. Create 3 branches (Downtown, Uptown, Westside)
      2. Check browser console for Firebase sync messages
      3. Verify branches saved in IndexedDB (F12 ‚Üí Application ‚Üí IndexedDB)
      4. Check Firebase console for branches in Firestore
    </div>
  </div>

  <script type="module">
    import { createBranch, getAllBranches } from '/src/services/branchService.js';
    
    // Make functions available globally
    window.createBranch = createBranch;
    window.getAllBranches = getAllBranches;
    
    window.testCreateBranch = async function() {
      const resultDiv = document.getElementById('result');
      const branchNameInput = document.getElementById('branchName');
      const branchName = branchNameInput.value.trim();
      
      if (!branchName) {
        resultDiv.className = 'result error';
        resultDiv.textContent = '‚ùå Please enter a branch name';
        return;
      }
      
      resultDiv.className = 'result info';
      resultDiv.innerHTML = '<span class="loading">Creating branch...</span>';
      
      try {
        // First, set up a mock user if not logged in
        if (!localStorage.getItem('currentUser')) {
          const mockUser = {
            id: 'test_admin_' + Date.now(),
            adminId: 'test_admin_' + Date.now(),
            role: 'admin',
            name: 'Test Admin'
          };
          localStorage.setItem('currentUser', JSON.stringify(mockUser));
          console.log('Created mock user for testing:', mockUser);
        }
        
        const branch = await createBranch({
          name: branchName,
          description: 'Created via test page'
        });
        
        resultDiv.className = 'result success';
        resultDiv.textContent = '‚úÖ Branch Created Successfully!\n\n' + JSON.stringify(branch, null, 2);
        
        // Clear input and suggest next branch
        branchNameInput.value = '';
        const suggestions = ['Uptown Branch', 'Westside Branch', 'Airport Branch'];
        const nextSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
        branchNameInput.placeholder = nextSuggestion;
        
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.textContent = '‚ùå Error creating branch:\n\n' + error.message + '\n\n' + error.stack;
        console.error('Branch creation error:', error);
      }
    };
    
    window.testGetAllBranches = async function() {
      const resultDiv = document.getElementById('result');
      resultDiv.className = 'result info';
      resultDiv.innerHTML = '<span class="loading">Loading branches...</span>';
      
      try {
        const branches = await getAllBranches();
        
        if (branches.length === 0) {
          resultDiv.className = 'result info';
          resultDiv.textContent = '‚ÑπÔ∏è No branches found. Create some branches first!';
        } else {
          resultDiv.className = 'result success';
          resultDiv.textContent = `‚úÖ Found ${branches.length} Branch(es):\n\n` + 
            JSON.stringify(branches, null, 2);
        }
        
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.textContent = '‚ùå Error loading branches:\n\n' + error.message + '\n\n' + error.stack;
        console.error('Branch loading error:', error);
      }
    };
    
    window.testClearBranches = async function() {
      if (!confirm('Are you sure you want to clear all test branches?')) {
        return;
      }
      
      const resultDiv = document.getElementById('result');
      resultDiv.className = 'result info';
      resultDiv.innerHTML = '<span class="loading">Clearing branches...</span>';
      
      try {
        localStorage.removeItem('pos-branches');
        localStorage.removeItem('branch-offline-queue');
        
        resultDiv.className = 'result success';
        resultDiv.textContent = '‚úÖ Local branches cleared!\n\nNote: Firebase branches remain. To clear Firebase, use the Firebase console.';
        
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.textContent = '‚ùå Error clearing branches:\n\n' + error.message;
        console.error('Clear error:', error);
      }
    };
    
    console.log('%cüè¢ Branch Service Test Page Loaded', 'color: green; font-size: 16px; font-weight: bold');
    console.log('Functions available: createBranch(), getAllBranches()');
  </script>
</body>
</html>
